<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Traffic Analyzer Report</title>
  <style>
    :root {
      --bg: #0f1115;
      --card: #161a23;
      --muted: #9aa4b2;
      --text: #e6e6e6;
      --accent: #6ea8fe;
      --good: #3ddc97;
      --warn: #f2c94c;
      --bad: #ff6b6b;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at top right, #10131a 0%, var(--bg) 40%);
      color: var(--text);
      padding: 24px;
    }
    .container { max-width: 1100px; margin: 0 auto; }
    .title { font-size: 28px; margin: 0 0 10px; letter-spacing: 0.2px; }
    .subtitle { color: var(--muted); margin-bottom: 24px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px; }
    .card { background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); border: 1px solid #232739; border-radius: 16px; padding: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
    .card h3 { margin-top: 0; font-size: 16px; letter-spacing: 0.3px; }
    .stat { font-size: 26px; font-weight: 700; }
    table { width: 100%; border-collapse: collapse; font-size: 14px; }
    th, td { padding: 8px 10px; border-bottom: 1px solid #212639; }
    th { text-align: left; color: var(--muted); font-weight: 600; }
    .tag { display: inline-block; padding: 6px 10px; margin: 4px 6px 0 0; background: #1e2435; border: 1px solid #273152; border-radius: 999px; font-size: 12px; color: #bcd1ff; }
    .muted { color: var(--muted); }
    .pill { display: inline-block; padding: 2px 8px; border-radius: 999px; background: #1e2435; border: 1px solid #273152; color: #cbd5e1; font-size: 12px; }
    .footer { margin-top: 24px; color: var(--muted); font-size: 12px; text-align: center; }
    .ai-disabled { color: var(--warn); font-weight: 600; }
    .list { margin: 0; padding-left: 18px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="title">AI Traffic Analyzer Report</h1>
    <div class="subtitle">
      <span class="pill">Mode: {{ capture.mode or 'unknown' }}</span>
      {% if capture.iface %}<span class="pill">Interface: {{ capture.iface }}</span>{% endif %}
      {% if capture.filter %}<span class="pill">Filter: <span class="mono">{{ capture.filter }}</span></span>{% endif %}
      {% if capture.pcap %}<span class="pill">PCAP: <span class="mono">{{ capture.pcap }}</span></span>{% endif %}
      <span class="pill">Packets: {{ metrics.total_packets }}</span>
      <span class="pill">Bytes: {{ metrics.total_bytes }}</span>
      <div class="muted" style="margin-top:8px;">Start: {{ capture.start_time }} â€¢ End: {{ capture.end_time }}</div>
    </div>

    <div class="grid">
      <div class="card">
        <h3>Traffic Overview</h3>
        <div class="stat">{{ metrics.total_packets }}</div>
        <div class="muted">total packets</div>
        <div style="height:8px;"></div>
        <div class="stat">{{ metrics.total_bytes }}</div>
        <div class="muted">total bytes</div>
      </div>

      <div class="card">
        <h3>Protocol Breakdown</h3>
        <table>
          <thead><tr><th>Protocol</th><th>Count</th></tr></thead>
          <tbody>
            {% for proto, cnt in metrics.protocols %}
            <tr><td>{{ proto }}</td><td>{{ cnt }}</td></tr>
            {% else %}
            <tr><td colspan="2" class="muted">No protocols observed</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="card">
        <h3>Top Talkers (IPs)</h3>
        <table>
          <thead><tr><th>IP</th><th>Pkts</th></tr></thead>
          <tbody>
            {% for ip, cnt in metrics.top_ips %}
            <tr><td class="mono">{{ ip }}</td><td>{{ cnt }}</td></tr>
            {% else %}
            <tr><td colspan="2" class="muted">No IPs observed</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="card">
        <h3>Top Ports</h3>
        <table>
          <thead><tr><th>Port</th><th>Pkts</th></tr></thead>
          <tbody>
            {% for port, cnt in metrics.top_ports %}
            <tr><td class="mono">{{ port }}</td><td>{{ cnt }}</td></tr>
            {% else %}
            <tr><td colspan="2" class="muted">No ports observed</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="card">
        <h3>TCP Flags</h3>
        <table>
          <thead><tr><th>Flag</th><th>Count</th></tr></thead>
          <tbody>
            {% for flag, cnt in metrics.tcp_flags %}
            <tr><td>{{ flag }}</td><td>{{ cnt }}</td></tr>
            {% else %}
            <tr><td colspan="2" class="muted">No TCP flags observed</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="card">
        <h3>AI Summary</h3>
        {% if ai_disabled %}
          <div class="ai-disabled">AI disabled (no OPENAI_API_KEY). Add a .env file to enable.</div>
        {% else %}
          {% if ai.summary_bullets %}
            <ul class="list">
              {% for bullet in ai.summary_bullets %}
              <li>{{ bullet }}</li>
              {% endfor %}
            </ul>
          {% else %}
            <div class="muted">No summary from AI.</div>
          {% endif %}
          {% if ai.tags %}
            <div style="margin-top: 8px;">
              {% for tag in ai.tags %}
              <span class="tag">{{ tag }}</span>
              {% endfor %}
            </div>
          {% endif %}
        {% endif %}
      </div>
    </div>

    <div class="footer">
      Generated by <span class="mono">ai-traffic-analyzer-mini</span>
    </div>
  </div>
</body>
</html>
